
# -- ${pojo.shortName}-START
<#assign pojoNameLower = pojo.shortName.substring(0,1).toLowerCase()+pojo.shortName.substring(1)>
<#foreach field in pojo.getAllPropertiesIterator()>
<#if !c2h.isCollection(field) && !c2h.isManyToOne(field) && !c2j.isComponent(field)>
    
</#if>
</#foreach>

${pojoNameLower}.added=${pojo.shortName} has been added successfully.
${pojoNameLower}.updated=${pojo.shortName} has been updated successfully.
${pojoNameLower}.deleted=${pojo.shortName} has been deleted successfully.

# -- ${pojoNameLower} list page --
${pojoNameLower}List.title=${pojo.shortName} List
${pojoNameLower}List.heading=${pojo.shortName} List

${pojoNameLower}List.${pojoNameLower}=${pojoNameLower}


# -- ${pojoNameLower} detail page --
${pojoNameLower}Detail.title=${pojo.shortName} Detail
${pojoNameLower}Detail.heading=${pojo.shortName} Information
# -- ${pojo.shortName}-END<#assign pojoNameLower = pojo.shortName.substring(0,1).toLowerCase()+pojo.shortName.substring(1)>
<#assign basepackage = pojo.packageName.substring(0,pojo.packageName.lastIndexOf("."))>

<#assign actionpath = basepackage.substring(basepackage.lastIndexOf(".")+1)>

package ${basepackage}.web.${actionpath};

import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;

import org.apache.struts2.ServletActionContext;
import org.apache.struts2.convention.annotation.Result;
import org.apache.struts2.convention.annotation.Results;
import org.springframework.beans.factory.annotation.Autowired;

import ${pojo.packageName}.${pojo.shortName};
import ${basepackage}.service.I${pojo.shortName}Service;
import org.supermy.core.service.Page;
import org.supermy.core.web.BaseActionSupport;
import org.supermy.core.web.Struts2Utils;

@Results( { @Result(name = BaseActionSupport.RELOAD, 
	location = "${util.build(pojo.shortName)}.action?page${pojo.shortName.toLowerCase()}.pageRequest=${'$'}{page${pojo.shortName.toLowerCase()}.pageRequest}", 
	type = "redirect") })
public class ${pojo.shortName}Action extends BaseActionSupport<${pojo.shortName}> {

	@Autowired
	private I${pojo.shortName}Service ${pojoNameLower}Service;

	// 基本属性
	private ${pojo.shortName} ${pojoNameLower};
	private Long id;
	private Page<${pojo.shortName}> page${pojo.shortName.toLowerCase()} = new Page<${pojo.shortName}>(5);

	// 基本属性访问函数 //
	public ${pojo.shortName} getModel() {
		return ${pojoNameLower};
	}


	/**
	 * @return the page${pojo.shortName}
	 */
	public Page<${pojo.shortName}> getPage${pojo.shortName.toLowerCase()}() {
		return page${pojo.shortName.toLowerCase()};
	}


	@Override
	protected void prepareModel() throws Exception {
		if (id != null) {
			${pojoNameLower} = ${pojoNameLower}Service.get${pojo.shortName}Util().get(id);
		} else {
			${pojoNameLower} = new ${pojo.shortName}();
		}
	}

	public void setId(Long id) {
		this.id = id;
	}



	// CRUD Action 函数 //

	@Override
	public String list() throws Exception {
		page${pojo.shortName.toLowerCase()} = ${pojoNameLower}Service.get${pojo.shortName}Util().get(page${pojo.shortName.toLowerCase()});
		log.debug("find :{}", page${pojo.shortName.toLowerCase()}.getResult());
		log.debug("find ${pojoNameLower} by page:" + page${pojo.shortName.toLowerCase()}.getResult().size());
		return SUCCESS;
	}

	@Override
	public String input() throws Exception {
		return INPUT;
	}

	@Override
	public String save() throws Exception {
		${pojoNameLower}Service.get${pojo.shortName}Util().save(${pojoNameLower});
		addActionMessage("保存成功");
		return RELOAD;
	}

	@Override
	public String delete() throws Exception {
		try {
			${pojoNameLower}Service.get${pojo.shortName}Util().delete(id);
			addActionMessage("删除成功");
		} catch (RuntimeException e) {
			log.error(e.getMessage(), e);
			addActionMessage(e.getMessage());
		}
		return RELOAD;
	}

	// 其他属性访问函数与Action函数 //


	/**
	 * 根据属性过滤条件搜索.
	 */
	public String search() throws Exception {

		// 因为搜索时不保存分页参数,因此将页面大小设到最大.
		page${pojo.shortName.toLowerCase()}.setPageSize(Page.MAX_PAGESIZE);

		Map<String, Object> filters = Struts2Utils.buildPropertyFilters("filter_");
		if (filters.size() <= 0) {
			addActionMessage("没有搜索条件");
		}
		page${pojo.shortName.toLowerCase()} = ${pojoNameLower}Service.get${pojo.shortName}Util().search(page${pojo.shortName.toLowerCase()}, filters);
		return SUCCESS;
	}

}<#assign pojoNameLower = pojo.shortName.substring(0,1).toLowerCase()+pojo.shortName.substring(1)>


<%@ page contentType="text/html;charset=UTF-8"%>
<%@ include file="/common/taglibs.jsp"%>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title><s:text name="${pojoNameLower}Detail.title"/></title>
    <meta name="heading" content="<s:text name='${pojoNameLower}Detail.heading'/>"/>

	<%@ include file="/common/meta.jsp"%>
	<%@ include file="/common/css.jsp"%>

	<link href="${'$'}{css}/js/validate/jquery.validate.css" type="text/css" rel="stylesheet" />
	<script src="${'$'}{js}/js/jquery.js" type="text/javascript"></script>
	<script src="${'$'}{js}/js/validate/jquery.validate.js" type="text/javascript"></script>
	<script src="${'$'}{js}/js/validate/localization/messages_cn.js" type="text/javascript"></script>
	<script>
		${'$'}(document).ready(function(){
			//聚焦第一个输入框
			${'$'}("#email").focus();
			//为inputForm注册validate函数
			${'$'}("#inputForm").validate({
				rules: {<#rt/>
					<#foreach field in pojo.getAllPropertiesIterator()>					
					<#if field.equals(pojo.identifierProperty)>
						<#lt/><#rt/>
					<#elseif !c2h.isCollection(field) && !c2h.isManyToOne(field) && !c2j.isComponent(field)>
					    <#foreach column in field.getColumnIterator()>
					        <#if field.value.typeName == "java.util.Date">
					            <#if (!column.nullable)>${field.name}: "required",</#if>
					        <#elseif field.value.typeName == "boolean" || field.value.typeName == "java.lang.Boolean">
					            <#if (!column.nullable)>${field.name}: "required",</#if>
					        <#else>
								<#if ((column.length > 0) && (!column.nullable))>
	                    		${field.name}:{
		                    		<#if (field.name.toLowerCase().endsWith("email"))>email:true,</#if>
			    					required: true,
			    					maxlength:${column.length}
			    				},			    									            
						        <#elseif (column.length > 0)>
	                    		${field.name}:{
		                    		<#if (field.name.toLowerCase().endsWith("email"))>email:true,</#if>
			    					maxlength:${column.length}
			    				},			    									            								
						        <#elseif (!column.nullable)>
	                    		${field.name}:{
		                    		<#if (field.name.toLowerCase().endsWith("email"))>email:true,</#if>
			    					required: true
			    				},	    									            								
								</#if>
					        </#if>
					    </#foreach>
					<#elseif c2h.isManyToOne(field)>
					    <#lt/>
					<#foreach column in field.getColumnIterator()>
					    </#foreach>
					</#if>
					</#foreach>
				},
				messages: {
					
				}
			});
		});
		
	</script>
</head>

<body>
<div class="container">

	<%@ include file="/common/tools.jsp"%>
	
	<%@ include file="/common/nav.jsp"%>
	
	<div class="span-15 prepend-1 colborder">
		<h3><s:if test="id == null">创建</s:if><s:else>修改</s:else><s:text name="${pojoNameLower}Detail.title"/></h3>


		<form id="inputForm" action="${util.build(pojo.shortName)}!save.action" method="post">
		<input type="hidden" name="id" value="${'$'}{id}" />
		<input type="hidden" name="page${pojo.shortName.toLowerCase()}.pageRequest" value="${'$'}{page${pojo.shortName.toLowerCase()}.pageRequest}" />
		<table class="inputView">
			<#foreach field in pojo.getAllPropertiesIterator()>
			<#if field.equals(pojo.identifierProperty)>
				<#lt/>
			<#elseif !c2h.isCollection(field) && !c2h.isManyToOne(field) && !c2j.isComponent(field)>
			    <#foreach column in field.getColumnIterator()>
				<tr>
					<td><s:text name="${pojoNameLower}.${field.name}"/></td>
					<td>
			        <#if field.name == "create">
				            ${'$'}{${field.name}}					
			        <#else>
				        <#if field.value.typeName == "java.util.Date">
				            <input type="text" name="${field.name}" size="30" value="${'$'}{${field.name}}" />
				        <#elseif field.value.typeName == "boolean" || field.value.typeName == "java.lang.Boolean">
		             		<s:checkbox key="${field.name}" cssClass="checkbox" theme="simple"/>
				        <#else>
				            <input type="text" name="${field.name}" size="30" value="${'$'}{${field.name}}" />
				        </#if>
			        </#if>
					</td>
				</tr>
			    </#foreach>
			<#elseif c2h.isManyToOne(field)>
			    <#foreach column in field.getColumnIterator()>
			    </#foreach>
			</#if>
			</#foreach>
		
			<tr>
				<td colspan="2">
					<input type="submit" value="提交" />&nbsp; 
			        <c:if test="${'$'}{not empty id}">			        
			            <s:submit cssClass="button" method="delete" key="button.delete"
			                onclick="return confirmDelete('${pojo.shortName}')" theme="simple"/>
			        </c:if>
					<input type="button" value="取消" onclick="history.back()"/>
				</td>
			</tr>
		</table>
		</form>
		
	</div>
	<div class="column span-7 last">
		
	</div>

	<%@ include file="/common/footer.jsp"%>
	
</div>
</body>
</html><#assign pojoNameLower = pojo.shortName.substring(0,1).toLowerCase()+pojo.shortName.substring(1)>
<#assign basepackage = pojo.packageName.substring(0,pojo.packageName.lastIndexOf("."))>
<#assign basepackage = basepackage.substring(basepackage.lastIndexOf(".")+1)>

<%@ page contentType="text/html;charset=UTF-8"%>
<%@ page import="org.supermy.core.security.SecurityUtils" %>
<%@ include file="/common/taglibs.jsp"%>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>

    <title><s:text name="${pojoNameLower}List.title"/></title>
    <meta name="heading" content="<s:text name='${pojoNameLower}List.heading'/>"/>

	<%@ include file="/common/meta.jsp"%>
	<%@ include file="/common/css.jsp"%>

</head>

<body>
<div class="container">

	<%@ include file="/common/tools.jsp"%>
	
	<%@ include file="/common/nav.jsp"%>
	
	<div class="span-17 prepend-1 colborder">

		<display:table 
			name="page${pojo.shortName.toLowerCase()}.result" 
			sort="external"
			class="table" 
			requestURI="" 
			id="${pojoNameLower}List" 
			export="false">
			<#foreach field in pojo.getAllPropertiesIterator()>
			<#if field.equals(pojo.identifierProperty)>
			
			    <display:column property="${field.name}" 
			    	sortable="false"
			    	sortName="${field.name}" 
			    	href="${util.build(pojo.shortName)}!input.action?page${pojo.shortName.toLowerCase()}.pageRequest=${'$'}{page${pojo.shortName.toLowerCase()}.pageRequest}" media="html"
			        paramId="${field.name}" 
			        paramProperty="${field.name}" 
			        titleKey="${pojoNameLower}.${field.name}"/>
			    <display:column 
			    	property="${field.name}" 
			    	media="csv excel xml pdf"
			    	titleKey="${pojoNameLower}.${field.name}"/>
			    	
			<#elseif !c2h.isCollection(field) && !c2h.isManyToOne(field) && !c2j.isComponent(field)>
			
			    <#if field.value.typeName == "java.util.Date">
		            <display:column sortProperty="${field.name}" sortable="false" sortName="${field.name}" titleKey="${pojoNameLower}.${field.name}">
		                 <fmt:formatDate value="${'$'}{${pojoNameLower}List.${field.name}}" pattern="${'$'}{datePattern}"/>
		            </display:column>
		            	             
			    <#elseif field.value.typeName == "boolean" || field.value.typeName == "java.lang.Boolean">
		             <display:column sortProperty="${field.name}" sortable="false" sortName="${field.name}" titleKey="${pojoNameLower}.${field.name}">
		                 <input type="checkbox" disabled="disabled" <c:if test="${'$'}{${pojoNameLower}List.${field.name}}">checked="checked"</c:if>/>
		             </display:column>
		             
			    <#else>
	        	    <display:column property="${field.name}" sortable="false" sortName="${field.name}" titleKey="${pojoNameLower}.${field.name}"/>
			    
			    </#if>
			</#if>
			
			</#foreach>
			
		    <display:setProperty name="paging.banner.item_name"><s:text name="${pojoNameLower}List.${pojoNameLower}"/></display:setProperty>
		    <display:setProperty name="paging.banner.items_name"><s:text name="${pojoNameLower}List.${pojoNameLower}s"/></display:setProperty>
		
		    <display:setProperty name="export.excel.filename"><s:text name="${pojoNameLower}List.title"/>.xls</display:setProperty>
		    <display:setProperty name="export.csv.filename"><s:text name="${pojoNameLower}List.title"/>.csv</display:setProperty>
		    <display:setProperty name="export.pdf.filename"><s:text name="${pojoNameLower}List.title"/>.pdf</display:setProperty>
		</display:table>
		
		
		<script type="text/javascript">
		    //highlightTableRows("${pojoNameLower}List");
		</script>

		
	</div>
	
	<div class="column span-5 last">
		<s:actionmessage theme="mytheme"/>
		<hr class="space"/>
		<security:authorize ifAnyGranted="AUTH_MODIFY_USER">
			<a href="${util.build(pojo.shortName)}!input.action?page${pojo.shortName.toLowerCase()}.pageRequest=${'$'}{page${pojo.shortName.toLowerCase()}.pageRequest}">新建</a>
		</security:authorize>
		<hr class="space"/>
		<div id="filter">
			<form action="${pojo.shortName}!search.action" method="post">
				<input type="text" 
						name="filter_LIKE_name|email" 
						value="${'$'}{param['filter_LIKE_name|email']}" 
						size="10"/>
				<input type="submit" value="搜索" />
			</form>
		</div> 
	</div>
		

	<%@ include file="/common/footer.jsp"%>
</div>
</body>

</html>
